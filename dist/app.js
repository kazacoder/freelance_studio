(()=>{"use strict";var e={550:(e,t,s)=>{s.d(t,{A:()=>i});var n=s(601),a=s.n(n),o=s(314),r=s.n(o)()(a());r.push([e.id,".freelancers .freelancer-avatar{width:40px;height:40px;border-radius:5px}.freelancers .freelancer-tools{display:flex;justify-content:space-between;align-items:center;gap:5px}.freelancer .box-profile #level{font-size:32px}.sidebar .image i.fa{color:#fff;font-size:34px;display:flex;justify-content:center;align-items:center}",""]);const i=r},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",n=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),n&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),n&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,n,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(n)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(r[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);n&&r[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),s&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=s):d[2]=s),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),t.push(d))}},t}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function s(e){for(var s=-1,n=0;n<t.length;n++)if(t[n].identifier===e){s=n;break}return s}function n(e,n){for(var o={},r=[],i=0;i<e.length;i++){var l=e[i],c=n.base?l[0]+n.base:l[0],d=o[c]||0,m="".concat(c," ").concat(d);o[c]=d+1;var u=s(m),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(h);else{var p=a(h,n);n.byIndex=i,t.splice(i,0,{identifier:m,updater:p,references:1})}r.push(m)}return r}function a(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,a){var o=n(e=e||[],a=a||{});return function(e){e=e||[];for(var r=0;r<o.length;r++){var i=s(o[r]);t[i].references--}for(var l=n(e,a),c=0;c<o.length;c++){var d=s(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},659:e=>{var t={};e.exports=function(e,s){var n=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(s)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,s)=>{e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var n="";s.supports&&(n+="@supports (".concat(s.supports,") {")),s.media&&(n+="@media ".concat(s.media," {"));var a=void 0!==s.layer;a&&(n+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),n+=s.css,a&&(n+="}"),s.media&&(n+="}"),s.supports&&(n+="}");var o=s.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.nc=void 0;var n=s(72),a=s.n(n),o=s(825),r=s.n(o),i=s(659),l=s.n(i),c=s(56),d=s.n(c),m=s(540),u=s.n(m),h=s(113),p=s.n(h),f=s(550),y={};y.styleTagTransform=p(),y.setAttributes=d(),y.insert=l().bind(null,"head"),y.domAPI=r(),y.insertStyleElement=u(),a()(f.A,y),f.A&&f.A.locals&&f.A.locals;class g{constructor(){console.log("Dashboard")}}const v="http://185.155.17.105:3000",E=v+"/api",w=v,T={junior:"junior",middle:"middle",senior:"senior"};class b{static accessTokenKey="accessToken";static refreshTokenKey="refreshToken";static userInfoTokenKey="userInfo";static setAuthInfo(e,t,s=null){localStorage.setItem(this.accessTokenKey,e),localStorage.setItem(this.refreshTokenKey,t),s&&localStorage.setItem(this.userInfoTokenKey,JSON.stringify(s))}static removeAuthInfo(){localStorage.removeItem(this.accessTokenKey),localStorage.removeItem(this.refreshTokenKey),localStorage.removeItem(this.userInfoTokenKey)}static getAuthInfo(e=null){return e&&[this.accessTokenKey,this.refreshTokenKey,this.userInfoTokenKey].includes(e)?localStorage.getItem(e):e?null:{[this.accessTokenKey]:localStorage.getItem(this.accessTokenKey),[this.refreshTokenKey]:localStorage.getItem(this.refreshTokenKey),[this.userInfoTokenKey]:localStorage.getItem(this.userInfoTokenKey)}}static async updateRefreshToken(){let e=!1;const t=this.getAuthInfo(this.refreshTokenKey);if(t){const s=await fetch(E+"/refresh",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(s&&200===s.status){const t=await s.json();t&&!t.error&&(this.setAuthInfo(t.accessToken,t.refreshToken),e=!0)}}return e||this.removeAuthInfo(),e}}class I{static async request(e,t="GET",s=!0,n=null){const a={error:!1,response:null},o={method:t,headers:{Accept:"application/json","Content-Type":"application/json"}};let r;s&&(r=b.getAuthInfo(b.accessTokenKey),r&&(o.headers.authorization=r)),n&&(o.body=JSON.stringify(n));let i=null;try{i=await fetch(E+e,o),a.response=await i.json()}catch(e){return a.error=!0,a}if((i.status<200||i.status>=300)&&(a.error=!0,s&&401===i.status))if(r){if(await b.updateRefreshToken())return this.request(e,t,s,n);a.redirect="/login"}else a.redirect="/login";return a}}class k{constructor(e){if(this.openNewRoute=e,b.getAuthInfo(b.accessTokenKey))return this.openNewRoute("/");this.emailElement=document.getElementById("email"),this.passwordElement=document.getElementById("password"),this.rememberMeElement=document.getElementById("remember"),this.commonErrorElement=document.getElementById("common-error"),document.getElementById("process-button").addEventListener("click",this.login.bind(this))}validateForm(){let e=!0;return this.emailElement.value&&this.emailElement.value.match(/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/)?this.emailElement.classList.remove("is-invalid"):(this.emailElement.classList.add("is-invalid"),e=!1),this.passwordElement.value?this.passwordElement.classList.remove("is-invalid"):(this.passwordElement.classList.add("is-invalid"),e=!1),e}async login(){if(this.commonErrorElement.style.display="none",this.validateForm()){const e=await I.request("/login","POST",!1,{email:this.emailElement.value,password:this.passwordElement.value,rememberMe:this.rememberMeElement.checked});if(e.error||!e.response||e.response&&(!e.response.accessToken||!e.response.refreshToken||!e.response.id||!e.response.name))return this.commonErrorElement.style.display="block",void(e.response.message&&(this.commonErrorElement.innerText=e.response.message));this.rememberMeElement.checked,b.setAuthInfo(e.response.accessToken,e.response.refreshToken,{id:e.response.id,name:e.response.name}),this.openNewRoute("/")}}}class L{constructor(e){if(this.openNewRoute=e,localStorage.getItem("accessToken"))return this.openNewRoute("/");this.nameElement=document.getElementById("name"),this.lastNameElement=document.getElementById("last-name"),this.emailElement=document.getElementById("email"),this.passwordElement=document.getElementById("password"),this.passwordRepeatElement=document.getElementById("password-repeat"),this.argeeElement=document.getElementById("agree"),this.commonErrorElement=document.getElementById("common-error"),document.getElementById("process-button").addEventListener("click",this.signUp.bind(this))}validateForm(){let e=!0;return this.nameElement.value?this.nameElement.classList.remove("is-invalid"):(this.nameElement.classList.add("is-invalid"),e=!1),this.lastNameElement.value?this.lastNameElement.classList.remove("is-invalid"):(this.lastNameElement.classList.add("is-invalid"),e=!1),this.emailElement.value&&this.emailElement.value.match(/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/)?this.emailElement.classList.remove("is-invalid"):(this.emailElement.classList.add("is-invalid"),e=!1),this.passwordElement.value&&this.passwordElement.value.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,}$/)?this.passwordElement.classList.remove("is-invalid"):(this.passwordElement.classList.add("is-invalid"),e=!1),this.passwordRepeatElement.value&&this.passwordRepeatElement.value===this.passwordElement.value?this.passwordRepeatElement.classList.remove("is-invalid"):(this.passwordRepeatElement.classList.add("is-invalid"),e=!1),this.argeeElement.checked?this.argeeElement.classList.remove("is-invalid"):(this.argeeElement.classList.add("is-invalid"),e=!1),e}async signUp(){if(this.commonErrorElement.style.display="none",this.validateForm()){const e=await I.request("/signup","POST",!1,{name:this.nameElement.value,lastName:this.lastNameElement.value,email:this.emailElement.value,password:this.passwordElement.value});if(e.error||!e.response||e.response&&(!e.response.accessToken||!e.response.refreshToken||!e.response.id||!e.response.name))return this.commonErrorElement.style.display="block",void(e.response.message&&(this.commonErrorElement.innerText=e.response.message));b.setAuthInfo(e.response.accessToken,e.response.refreshToken,{id:e.response.id,name:e.response.name}),console.log(e),this.openNewRoute("/")}}}class x{constructor(e){if(this.openNewRoute=e,this.refreshToken=b.getAuthInfo(b.refreshTokenKey),!b.getAuthInfo(b.accessTokenKey)||!this.refreshToken)return this.openNewRoute("/login");this.logout().then()}async logout(){const e=await I.request("/logout","POST",!1,{refreshToken:this.refreshToken});console.log(e),b.removeAuthInfo(),this.openNewRoute("/login")}}class N{static getLevelHtml(e){let t=null;switch(e){case T.junior:t='<span class="badge badge-info">Junior</span>';break;case T.middle:t='<span class="badge badge-warning">Middle</span>';break;case T.senior:t='<span class="badge badge-success">Senior</span>';break;default:t='<span class="badge badge-secondary">Unknown</span>'}return t}}class S{constructor(e){this.recordsElement=document.getElementById("records"),this.openNewRoute=e,console.log("FreelancersList"),this.getFreelancers().then()}async getFreelancers(){const e=await I.request("/freelancers");return e.redirect?this.openNewRoute(e.redirect):e.error||!e.response||e.response&&(e.response.error||!e.response.freelancers)?alert("Возникла ошибка при запросе фрилансеров. Обратитесь в поддержку"):void this.showRecords(e.response.freelancers)}showRecords(e){console.log(e),e.forEach(((e,t)=>{const s=document.createElement("tr");s.insertCell().innerText=t+1,s.insertCell().innerHTML=e.avatar?`<img class="freelancer-avatar" src="${w}${e.avatar}" alt="User photo">`:"",s.insertCell().innerText=e.name+" "+e.lastName,s.insertCell().innerText=e.email,s.insertCell().innerHTML=N.getLevelHtml(e.level),s.insertCell().innerText=e.education,s.insertCell().innerText=e.location,s.insertCell().innerText=e.skills,s.insertCell().innerHTML='<div class="freelancer-tools"><a href="/freelancers/view?id='+e.id+'" class="fas fa-eye" title="Просмотр"></a><a href="/freelancers/edit?id='+e.id+'" class="fas fa-edit" title="Редактирование"></a><a href="/freelancers/delete?id='+e.id+'" class="fas fa-trash" title="Удаление"></a></div>',this.recordsElement.appendChild(s)})),new DataTable("#data-table",{language:{lengthMenu:"Показывать _MENU_ записей на странице",search:"Фильтр:",info:"Страница _PAGE_ из _PAGES_",paginate:{next:"Вперед",previous:"Назад"}},paging:!0})}}class R{static loadPageScript(e){return new Promise(((t,s)=>{const n=document.createElement("script");n.src=e,n.onload=()=>t("Script loaded: "+e),n.onerror=()=>s(new Error("Script load error for: "+e)),document.body.appendChild(n)}))}static loadPageStyle(e,t){const s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=e,document.head.insertBefore(s,t)}}class A{constructor(e){this.openNewRoute=e;const t=new URLSearchParams(window.location.search).get("id");if(!t)return this.openNewRoute("/");this.getFreelancer(t).then(),document.getElementById("edit-link").href+=t,document.getElementById("delete-link").href+=t}async getFreelancer(e){const t=await I.request("/freelancers/"+e);return t.redirect?this.openNewRoute(t.redirect):t.error||!t.response||t.response&&t.response.error?(console.log(t.response.message),alert("Возникла ошибка при запросе фрилансера. Обратитесь в поддержку")):(console.log(t.response),void this.showFreelancer(t.response))}showFreelancer(e){e.avatar&&(document.getElementById("avatar").src=w+e.avatar),document.getElementById("name").innerText=`${e.name} ${e.lastName}`,document.getElementById("level").innerHTML=N.getLevelHtml(e.level),document.getElementById("email").innerText=e.email,document.getElementById("education").innerText=e.education,document.getElementById("location").innerText=e.location,document.getElementById("skills").innerText=e.skills,document.getElementById("info").innerText=e.info,e.createdAt&&(document.getElementById("created").innerText=new Date(e.createdAt).toLocaleString("ru-RU"))}}class B{constructor(e){this.openNewRoute=e,bsCustomFileInput.init(),this.inputs={},this.commonErrorElement=document.getElementById("common-error"),document.querySelectorAll("input, textarea, select").forEach((e=>{this.inputs[e.id+"Element"]=e})),this.textInputsArray=Object.values(this.inputs).filter((e=>"text"===e.type||"textarea"===e.type)),document.getElementById("saveButton").addEventListener("click",this.saveFreelancers.bind(this))}async saveFreelancers(e){if(this.commonErrorElement.style.display="none",e.preventDefault(),this.validateForm()){const e=await I.request("/freelancers","POST",!0,{name:this.inputs.nameInputElement.value,lastName:this.inputs.lastNameInputElement.value,email:this.inputs.emailInputElement.value,level:this.inputs.levelSelectElement.value,education:this.inputs.educationInputElement.value,location:this.inputs.locationInputElement.value,skills:this.inputs.skillsInputElement.value,info:this.inputs.infoInputElement.value});return e.redirect&&this.openNewRoute(e.redirect),e.error||!e.response||e.response&&e.response.error?(this.commonErrorElement.style.display="block",void(e.response.message&&(this.commonErrorElement.innerText=e.response.message))):this.openNewRoute("/freelancers/view?id="+e.response.id)}console.log("INVALID")}validateForm(){let e=!0;return this.inputs.emailInputElement.value&&this.inputs.emailInputElement.value.match(/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/)?this.inputs.emailInputElement.classList.remove("is-invalid"):(this.inputs.emailInputElement.classList.add("is-invalid"),e=!1),this.textInputsArray.forEach((t=>{t.value?t.classList.remove("is-invalid"):(t.classList.add("is-invalid"),e=!1)})),e}}class P{constructor(){this.titlePageElement=document.getElementById("title"),this.contentPageElement=document.getElementById("content"),this.adminlteStyleElement=document.getElementById("adminlte_style"),this.initEvents(),this.routes=[{route:"/",title:"Дашборд",filePathTemplate:"/templates/pages/dashboard.html",useLayout:"/templates/layout.html",load:()=>{new g},styles:[]},{route:"/404",title:"Страница не найдена",filePathTemplate:"/templates/pages/404.html",useLayout:!1},{route:"/login",title:"Авторизация",filePathTemplate:"/templates/pages/auth/login.html",useLayout:!1,load:()=>{document.body.classList.add("login-page"),document.body.style.height="100vh",new k(this.openNewRoute.bind(this))},unload:()=>{document.body.classList.remove("login-page"),document.body.style.height="auto"},styles:["icheck-bootstrap.min.css"]},{route:"/sign-up",title:"Регистрация",filePathTemplate:"/templates/pages/auth/sign-up.html",useLayout:!1,load:()=>{document.body.classList.add("register-page"),document.body.style.height="100vh",new L(this.openNewRoute.bind(this))},unload:()=>{document.body.classList.remove("register-page"),document.body.style.height="auto"},styles:["icheck-bootstrap.min.css"]},{route:"/logout",load:()=>{new x(this.openNewRoute.bind(this))}},{route:"/freelancers",title:"Фрилансеры",filePathTemplate:"/templates/pages/freelancers/list.html",useLayout:"/templates/layout.html",load:()=>{new S(this.openNewRoute.bind(this))},styles:["dataTables.bootstrap4.min.css"],scripts:["jquery.dataTables.min.js","dataTables.bootstrap4.min.js"]},{route:"/freelancers/create",title:"Создание фрилансера",filePathTemplate:"/templates/pages/freelancers/create.html",useLayout:"/templates/layout.html",load:()=>{new B(this.openNewRoute.bind(this))},styles:[],scripts:["bs-custom-file-input.min.js"]},{route:"/freelancers/view",title:"Фрилансер",filePathTemplate:"/templates/pages/freelancers/view.html",useLayout:"/templates/layout.html",load:()=>{new A(this.openNewRoute.bind(this))}}]}initEvents(){window.addEventListener("DOMContentLoaded",this.activateRoute.bind(this)),window.addEventListener("popstate",this.activateRoute.bind(this)),document.addEventListener("click",this.clickHandler.bind(this))}async openNewRoute(e){const t=window.location.pathname;history.pushState(null,"",e),await this.activateRoute(null,t)}async clickHandler(e){let t=null;if("A"===e.target.nodeName?t=e.target:"A"===e.target.parentNode.nodeName&&(t=e.target.parentNode),t){e.preventDefault();const s=window.location.pathname,n=t.href.replace(window.location.origin,"");if(!n||s===n.replace("#","")||n.startsWith("javascript:void(0)"))return;await this.openNewRoute(n)}}async activateRoute(e,t=null){if(t){const e=this.routes.find((e=>e.route===t));e.styles&&e.styles.length>0&&e.styles.forEach((e=>{document.querySelector(`link[href='/css/${e}']`).remove()})),e.scripts&&e.scripts.length>0&&e.scripts.forEach((e=>{document.querySelector(`script[src='/js/${e}']`).remove()})),e.unload&&"function"==typeof e.load&&e.unload()}const s=window.location.pathname,n=this.routes.find((e=>e.route===s));if(n){if(n.styles&&n.styles.length>0&&n.styles.forEach((e=>{R.loadPageStyle("/css/"+e,this.adminlteStyleElement)})),n.scripts&&n.styles.length>0)for(const e of n.scripts)await R.loadPageScript("/js/"+e);if(n.title&&(this.titlePageElement.innerText=n.title+" | Freelance Studio"),n.filePathTemplate){let e=this.contentPageElement;n.useLayout?(this.contentPageElement.innerHTML=await fetch(n.useLayout).then((e=>e.text())),e=document.getElementById("content-layout"),document.body.classList.add("sidebar-mini"),document.body.classList.add("layout-fixed")):(document.body.classList.remove("sidebar-mini"),document.body.classList.remove("layout-fixed")),e.innerHTML=await fetch(n.filePathTemplate).then((e=>e.text()))}n.load&&"function"==typeof n.load&&n.load()}else console.log("no route found"),history.pushState(null,"","/404"),await this.activateRoute()}}new class{constructor(){new P}}})();